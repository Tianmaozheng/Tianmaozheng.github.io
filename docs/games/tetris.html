<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰øÑÁΩóÊñØÊñπÂùó | Â∞èÁî∞ÁöÑÂ∞èÊ∏∏Êàè</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
            background: #0f172a; 
            color: #e2e8f0; 
            display: flex; 
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .wrap { 
            margin: auto; 
            display: flex; 
            gap: 28px; 
            align-items: flex-start; 
            padding: 16px;
            max-width: 100%;
        }
        
        .board { 
            background: #0b1220; 
            padding: 14px; 
            border-radius: 16px; 
            box-shadow: 0 20px 60px rgba(0,0,0,.3), inset 0 0 0 1px rgba(255,255,255,.06); 
            display: flex; 
            gap: 18px;
            position: relative;
        }
        
        canvas { 
            background: #0a1326; 
            border-radius: 10px; 
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
            display: block;
        }
        
        .side { 
            min-width: 200px; 
            display: flex; 
            flex-direction: column; 
            gap: 14px; 
        }
        
        .panel { 
            background: #0b1220; 
            border-radius: 12px; 
            padding: 12px 14px; 
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.06); 
        }
        
        .panel h3 { 
            margin: 0 0 8px; 
            font-size: 14px; 
            color: #94a3b8; 
            font-weight: 600; 
            letter-spacing: .3px; 
        }
        
        .stat { 
            font-size: 22px; 
            font-weight: 700; 
            color: #e2e8f0; 
        }
        
        .btns { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
        }
        
        button { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .help { 
            font-size: 12px; 
            color: #94a3b8; 
            line-height: 1.6; 
        }
        
        .next-wrap { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .badge { 
            font-size: 12px; 
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            color: #667eea;
            padding: 4px 10px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 999px;
            font-weight: 600;
        }

        /* ÂÖ®Â±èÊåâÈíÆ */
        .fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            color: #667eea;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .fullscreen-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
        }

        /* ÂÖ®Â±èÊ®°Âºè */
        .wrap.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            background: #0f172a;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .wrap.fullscreen .board {
            max-width: 100%;
            max-height: 100vh;
        }

        /* ÁßªÂä®Á´ØÊéßÂà∂ */
        .mobile-controls { 
            display: none; 
            position: fixed; 
            left: 0; 
            right: 0; 
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 16px 16px;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mc-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .mc-group { 
            display: flex; 
            gap: 8px; 
        }
        
        .mc-btn { 
            width: 56px; 
            height: 56px; 
            border-radius: 12px; 
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border: 1px solid rgba(102, 126, 234, 0.5);
            color: #e2e8f0; 
            font-size: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,.3);
            user-select: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .mc-btn:active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(0.95);
        }
        
        .mc-wide { 
            width: 100px;
            font-size: 14px;
            font-weight: 600;
        }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 900px) {
            body {
                overflow: hidden;
            }
            
            .wrap { 
                flex-direction: column; 
                align-items: center; 
                gap: 12px;
                padding: 12px 12px 180px;
                width: 100%;
                overflow-y: auto;
            }
            
            .board {
                width: 100%;
                max-width: 500px;
                padding: 12px;
            }
            
            .side { 
                width: 100%;
                flex-direction: row; 
                flex-wrap: wrap; 
                gap: 10px; 
                justify-content: center; 
            }
            
            .panel { 
                flex: 1 1 140px;
                min-width: 140px;
            }
            
            .mobile-controls { 
                display: block; 
            }
            
            .help {
                display: none;
            }
            
            .fullscreen-btn {
                top: 8px;
                right: 8px;
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .wrap {
                padding: 8px 8px 170px;
            }
            
            canvas#game {
                max-width: 100%;
                height: auto;
            }
            
            .mc-btn {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .mc-wide {
                width: 90px;
                font-size: 13px;
            }
            
            .panel {
                flex: 1 1 120px;
                min-width: 120px;
                padding: 10px;
            }
            
            .stat {
                font-size: 20px;
            }
        }
    </style>
    <link rel="icon" href="../personal_blog/img/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="wrap" id="gameWrap">
        <div class="board">
            <!-- ÂÖ®Â±èÊåâÈíÆ -->
            <button class="fullscreen-btn" id="fullscreenBtn" title="ÂÖ®Â±è/ÈÄÄÂá∫ÂÖ®Â±è">
                <i class="fas fa-expand"></i>
            </button>
            <canvas id="game" width="240" height="480"></canvas>
            <div class="side">
                <div class="panel">
                    <h3>ÂàÜÊï∞</h3>
                    <div class="stat" id="score">0</div>
                </div>
                <div class="panel">
                    <div class="next-wrap">
                        <h3 style="margin:0">‰∏ã‰∏Ä‰∏™</h3>
                        <span class="badge" id="level">Lv.1</span>
                    </div>
                    <canvas id="next" width="80" height="80" style="margin-top:6px;"></canvas>
                </div>
                <div class="panel btns">
                    <button id="start"><i class="fas fa-play"></i> ÂºÄÂßã/ÊöÇÂÅú</button>
                    <button id="restart"><i class="fas fa-redo"></i> ÈáçÊñ∞ÂºÄÂßã</button>
                    <button id="drop"><i class="fas fa-arrow-down"></i> Âø´ÈÄü‰∏ãËêΩ</button>
                </div>
                <div class="panel help">
                    <strong>üí° Êìç‰ΩúÊèêÁ§∫Ôºö</strong>
                    <div>‚Üê ‚Üí ÁßªÂä®  |  ‚Üë ÊóãËΩ¨  |  ‚Üì Âä†ÈÄü</div>
                    <div>Á©∫Ê†º Âø´ÈÄü‰∏ãËêΩ  |  P ÊöÇÂÅú  |  R ÈáçÂºÄ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile on-screen controls -->
    <div class="mobile-controls" aria-hidden="true">
        <div class="mc-row">
            <div class="mc-group">
                <div class="mc-btn" data-action="left" title="Â∑¶">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="mc-btn" data-action="right" title="Âè≥">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="mc-btn" data-action="rotate" title="ÊóãËΩ¨">
                    <i class="fas fa-undo"></i>
                </div>
            </div>
            <div class="mc-group">
                <div class="mc-btn mc-wide" data-action="hard" title="Âø´ÈÄü‰∏ãËêΩ">‰∏ãËêΩ</div>
                <div class="mc-btn" data-action="soft" title="Âä†ÈÄü">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="mc-btn" data-action="pause" title="ÊöÇÂÅú/ÁªßÁª≠">
                    <i class="fas fa-pause"></i>
                </div>
            </div>
        </div>
    </div>

    <script>
    (function(){
        // ÂÖ®Â±èÂäüËÉΩ
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const gameWrap = document.getElementById('gameWrap');
        const fullscreenIcon = fullscreenBtn.querySelector('i');
        
        let isFullscreen = false;
        
        fullscreenBtn.addEventListener('click', function() {
            if (!isFullscreen) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        });
        
        function enterFullscreen() {
            gameWrap.classList.add('fullscreen');
            fullscreenIcon.className = 'fas fa-compress';
            isFullscreen = true;
            
            // Â∞ùËØï‰ΩøÁî®ÂéüÁîüÂÖ®Â±èAPIÔºàÂèØÈÄâÔºâ
            if (gameWrap.requestFullscreen) {
                gameWrap.requestFullscreen().catch(err => console.log(err));
            } else if (gameWrap.webkitRequestFullscreen) {
                gameWrap.webkitRequestFullscreen();
            } else if (gameWrap.msRequestFullscreen) {
                gameWrap.msRequestFullscreen();
            }
        }
        
        function exitFullscreen() {
            gameWrap.classList.remove('fullscreen');
            fullscreenIcon.className = 'fas fa-expand';
            isFullscreen = false;
            
            // ÈÄÄÂá∫ÂéüÁîüÂÖ®Â±è
            if (document.exitFullscreen) {
                document.exitFullscreen().catch(err => console.log(err));
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
        
        // ÁõëÂê¨ÂéüÁîüÂÖ®Â±èÂèòÂåñ
        document.addEventListener('fullscreenchange', function() {
            if (!document.fullscreenElement) {
                gameWrap.classList.remove('fullscreen');
                fullscreenIcon.className = 'fas fa-expand';
                isFullscreen = false;
            }
        });
        
        // ESCÈîÆÈÄÄÂá∫ÂÖ®Â±è
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isFullscreen) {
                exitFullscreen();
            }
        });
        
        const COLS = 10, ROWS = 20, SIZE = 24;
        const canvas = document.getElementById('game');
        const nextCanvas = document.getElementById('next');
        const ctx = canvas.getContext('2d');
        const nctx = nextCanvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');

        const COLORS = {
            0: '#0a1326',
            1: '#22d3ee', // I
            2: '#f59e0b', // L
            3: '#8b5cf6', // J
            4: '#10b981', // S
            5: '#ef4444', // Z
            6: '#eab308', // O
            7: '#3b82f6'  // T
        };

        const SHAPES = {
            I: [[1,1,1,1]],
            L: [[2,0,0],[2,2,2]],
            J: [[0,0,3],[3,3,3]],
            S: [[0,4,4],[4,4,0]],
            Z: [[5,5,0],[0,5,5]],
            O: [[6,6],[6,6]],
            T: [[0,7,0],[7,7,7]]
        };
        const TYPES = Object.keys(SHAPES);

        let grid = createMatrix(COLS, ROWS);
        let piece = null;
        let nextPiece = randomPiece();
        let dropCounter = 0, dropInterval = 900;
        let lastTime = 0;
        let score = 0;
        let paused = false;
        let gameOver = false;

        function createMatrix(w,h){
            const m = [];
            for(let y=0;y<h;y++){ m.push(new Array(w).fill(0)); }
            return m;
        }
        function drawCell(x,y,val,context){
            const c = context||ctx;
            c.fillStyle = COLORS[val];
            c.fillRect(x*SIZE, y*SIZE, SIZE-1, SIZE-1);
        }
        function draw(){
            ctx.clearRect(0,0,canvas.width,canvas.height);
            for(let y=0;y<ROWS;y++){
                for(let x=0;x<COLS;x++) drawCell(x,y, grid[y][x]);
            }
            if(piece) drawPiece(piece, ctx);
        }
        function drawPiece(p, context){
            p.shape.forEach((row, y)=>{
                row.forEach((val,x)=>{ if(val) drawCell(p.x + x, p.y + y, val, context); });
            });
        }
        function merge(){
            piece.shape.forEach((row,y)=>{
                row.forEach((val,x)=>{ if(val) grid[piece.y+y][piece.x+x] = val; });
            });
        }
        function collide(nx=piece.x, ny=piece.y, shape=piece.shape){
            for(let y=0;y<shape.length;y++){
                for(let x=0;x<shape[y].length;x++){
                    if(shape[y][x]){
                        const gx = nx + x, gy = ny + y;
                        if(gx<0 || gx>=COLS || gy>=ROWS) return true;
                        if(gy>=0 && grid[gy][gx]) return true;
                    }
                }
            }
            return false;
        }
        function rotate(shape){
            const N = shape.length, M = shape[0].length;
            const res = Array.from({length:M},()=>Array(N).fill(0));
            for(let y=0;y<N;y++) for(let x=0;x<M;x++) res[x][N-1-y] = shape[y][x];
            return res;
        }
        function newPiece(){
            piece = nextPiece || randomPiece();
            nextPiece = randomPiece();
            drawNext();
            piece.x = (COLS>>1) - Math.ceil(piece.shape[0].length/2);
            piece.y = -1;
            if(collide(piece.x, piece.y, piece.shape)){
                gameOver = true;
                paused = true;
            }
        }
        function randomPiece(){
            const t = TYPES[(Math.random()*TYPES.length)|0];
            const shape = SHAPES[t].map(r=>r.slice());
            // normalize to numbers 1..7 already in shape
            return { shape, x:0, y:0 };
        }
        function drawNext(){
            nctx.clearRect(0,0,nextCanvas.width,nextCanvas.height);
            if(!nextPiece) return;
            // center in 4x4 box
            const offX = ((4 - nextPiece.shape[0].length)/2)|0;
            const offY = ((4 - nextPiece.shape.length)/2)|0;
            nextPiece.shape.forEach((row,y)=>{
                row.forEach((val,x)=>{ if(val){
                    nctx.fillStyle = COLORS[val];
                    const s = 18;
                    nctx.fillRect((offX+x)*s+2, (offY+y)*s+2, s-2, s-2);
                }});
            });
        }
        function sweep(){
            let lines = 0;
            for(let y=ROWS-1;y>=0;y--){
                if(grid[y].every(v=>v!==0)){
                    const row = grid.splice(y,1)[0].fill(0);
                    grid.unshift(row);
                    y++;
                    lines++;
                }
            }
            if(lines){
                const points = [0, 100, 300, 500, 800][lines] || lines*200;
                score += points;
                scoreEl.textContent = score;
                const level = 1 + Math.min(9, (score/1000)|0);
                levelEl.textContent = 'Lv.'+level;
                dropInterval = Math.max(120, 900 - (level-1)*80);
            }
        }
        function drop(){
            piece.y++;
            if(collide()){
                piece.y--;
                merge();
                sweep();
                newPiece();
            }
            dropCounter = 0;
        }
        function move(dir){
            piece.x += dir;
            if(collide()) piece.x -= dir;
        }
        function rotatePiece(){
            const r = rotate(piece.shape);
            const old = piece.shape; piece.shape = r;
            // wall kick simple
            if(collide()){
                piece.x++;
                if(collide()){ piece.x -= 2; if(collide()){ piece.x++; piece.shape = old; } }
            }
        }
        function hardDrop(){
            while(!collide()) piece.y++;
            piece.y--; merge(); sweep(); newPiece(); dropCounter = 0; draw();
        }
        function update(time=0){
            const dt = time - lastTime; lastTime = time;
            if(!paused){
                dropCounter += dt;
                if(dropCounter > dropInterval) drop();
                draw();
            }
            requestAnimationFrame(update);
        }

        document.addEventListener('keydown', e=>{
            if(gameOver){ if(e.key.toLowerCase()==='r') restart(); return; }
            switch(e.key){
                case 'ArrowLeft': move(-1); break;
                case 'ArrowRight': move(1); break;
                case 'ArrowDown': piece.y++; if(collide()) piece.y--; dropCounter=0; break;
                case 'ArrowUp': rotatePiece(); break;
                case ' ': e.preventDefault(); hardDrop(); break;
                case 'p': case 'P': paused = !paused; break;
                case 'r': case 'R': restart(); break;
            }
            draw();
        });
        // Touch controls with press-to-repeat for left/right/soft
        (function initTouch(){
            const map = {
                left: ()=>move(-1),
                right: ()=>move(1),
                rotate: ()=>rotatePiece(),
                soft: ()=>{ piece.y++; if(collide()) piece.y--; dropCounter=0; },
                hard: ()=>hardDrop(),
                pause: ()=>{ if(gameOver) restart(); else paused = !paused; }
            };
            let interval = null;
            let repeatAction = null;
            function startRepeat(fn){
                fn();
                repeatAction = fn;
                interval = setInterval(()=>{ fn(); draw(); }, 120);
            }
            function stopRepeat(){ if(interval){ clearInterval(interval); interval=null; } repeatAction=null; }
            document.querySelectorAll('.mc-btn').forEach(btn=>{
                const act = btn.getAttribute('data-action');
                const fn = map[act];
                if(!fn) return;
                if(act==='left'||act==='right'||act==='soft'){
                    btn.addEventListener('touchstart', e=>{ e.preventDefault(); if(gameOver) return; startRepeat(fn); });
                    btn.addEventListener('touchend', ()=>stopRepeat());
                    btn.addEventListener('touchcancel', ()=>stopRepeat());
                    btn.addEventListener('mousedown', e=>{ e.preventDefault(); if(gameOver) return; startRepeat(fn); });
                    btn.addEventListener('mouseup', ()=>stopRepeat());
                    btn.addEventListener('mouseleave', ()=>stopRepeat());
                } else {
                    btn.addEventListener('touchstart', e=>{ e.preventDefault(); if(gameOver && act!=='pause') return; fn(); draw(); });
                    btn.addEventListener('mousedown', e=>{ e.preventDefault(); if(gameOver && act!=='pause') return; fn(); draw(); });
                }
            });
        })();
        document.getElementById('start').onclick = ()=>{ if(gameOver) restart(); else paused = !paused; };
        document.getElementById('restart').onclick = ()=>restart();
        document.getElementById('drop').onclick = ()=>hardDrop();

        function restart(){
            grid = createMatrix(COLS,ROWS);
            score = 0; scoreEl.textContent = '0';
            dropInterval = 900; levelEl.textContent = 'Lv.1';
            paused = false; gameOver = false; nextPiece = randomPiece(); newPiece(); draw();
        }

        // init
        newPiece(); drawNext(); update();
    })();
    </script>
    
</body>
</html>


